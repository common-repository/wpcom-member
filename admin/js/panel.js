!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";jQuery((function(e){e("#j-panel-form").on("click",".upload-btn",(function(a){a.preventDefault();var t,n=e(this).attr("id");t||(t=wp.media.frames.file_frame=wp.media({title:"\u9009\u62e9\u6587\u4ef6",button:{text:"\u9009\u62e9\u6587\u4ef6"},multiple:!1})).on("select",(function(){var a=t.state().get("selection").first().toJSON(),i=n.replace(/_upload/i,"");e("#"+i).val(a.url)})),t.open()})).on("click",".input-img-add",(function(a){a.preventDefault();var t,n=this;t||(t=wp.media.frames.file_frame=wp.media({title:"\u9009\u62e9\u6587\u4ef6",button:{text:"\u9009\u62e9\u6587\u4ef6"},multiple:!1})).on("select",(function(){var a=e(n).closest(".input-img-wrap"),i=t.state().get("selection").first().toJSON();a.find('input[type="hidden"]').val(i.id),a.find(".input-img img").attr("src",i.url),a.find(".input-img").show()})),t.open()})).on("click",".input-img-close",(function(){var a=e(this).closest(".input-img-wrap");a.find('input[type="hidden"]').val(""),a.find(".input-img").hide()})).on("click",".toggle",(function(){var a=e(this);a.hasClass("active")?(a.removeClass("active"),a.next().val(0)):(a.addClass("active"),a.next().val(1)),a.next().trigger("change")})).on("click",".wpcom-panel-nav li",(function(){var a=e(this),t=e(".wpcom-panel-item");e(".wpcom-panel-nav li").removeClass("active"),a.addClass("active"),t.removeClass("active"),t.eq(a.index()).addClass("active");var n=new Date;n.setTime(n.getTime()+31536e6);var i=e("#j-panel-form").data("slug");document.cookie=i+"_nav="+a.index()+";expires="+n.toGMTString()+";path=/",a.hasClass("more-themes")||a.hasClass("theme-active")?e(".wpcom-panel-submit").hide():e(".wpcom-panel-submit").show()})).on("change",".toggle-wrap input",(function(){var a=e(this);1==a.val()?a.parent().find(".toggle").addClass("active"):a.parent().find(".toggle").removeClass("active")})).find(".color-picker").wpColorPicker(),e("#j-panel-form .wpcom-panel-nav li.active").trigger("click");var a=e("#wpcom-panel-form");a.on("click",".j-repeat-add",(function(){var a=e(this).parent().prev(),t=a.closest(".wpcom-panel-repeat"),n=a.html(),i=parseInt(a.data("id"))+1;n=(n=(n=(n=n.replace(/for="wpcom_(\S+)_(\d+)"/gim,'for="wpcom_$1_'+i+'"')).replace(/id="wpcom_(\S+)_(\d+)"/gim,'id="wpcom_$1_'+i+'"')).replace(/id="wpcom_(\S+)_(\d+)_upload"/gim,'id="wpcom_$1_'+i+'_upload"')).replace(/name="(\S+)\[(\d+)\](\[\])?"/gim,'name="$1['+i+']$3"'),0==a.find(".repeat-action").length?e('<div class="repeat-wrap" data-id="'+i+'">'+n+'<div class="repeat-action"><div class="repeat-item repeat-up j-repeat-up"><i class="dashicons dashicons-arrow-up-alt"></i></div><div class="repeat-item repeat-down j-repeat-down"><i class="dashicons dashicons-arrow-down-alt"></i></div><div class="repeat-item repeat-del j-repeat-del"><i class="dashicons dashicons-no-alt"></i></div></div></div>').insertAfter(a):e('<div class="repeat-wrap" data-id="'+i+'">'+n+"</div>").insertAfter(a);var r=t.find('[data-id="'+i+'"]');r.find("input[type=text]").val(""),r.find("textarea").val("");var c=r.find(".wp-picker-container");if(c.length)for(var p=0;p<c.length;p++)e(c[p]).replaceWith(e(c[p]).find(".color-picker"));r.find(".color-picker").wpColorPicker()})).on("click",".j-repeat-del",(function(){e(this).closest(".repeat-wrap").remove()})).on("click",".j-repeat-up,.j-repeat-down",(function(){var a=e(this),t=a.closest(".repeat-wrap"),n=t.prev(),i=n.data("id"),r=t.data("id");if(a.hasClass("j-repeat-down")){if(!(n=t.next()).hasClass("repeat-wrap"))return;i=n.data("id")}var c={};n.find("input,textarea,select").each((function(a,n){var p=e(n);if("checkbox"!=p.attr("type")&&"radio"!=p.attr("type")){var o=p.attr("name");if(o){var l=o.replace("["+i+"]","["+r+"]");c[l]=p.val(),p.val(t.find('[name="'+l+'"]').val()).trigger("change")}}})),n.find("input:checkbox:checked,input:radio:checked").each((function(a,t){var n=e(t),p=n.attr("name");if(p){var o=p.replace("["+i+"]","["+r+"]");c[o]=c[o]?c[o]:[],c[o].push(n.val())}}));var p=[];t.find("input:checkbox:checked,input:radio:checked").each((function(a,t){var n=e(t),c=n.attr("name");if(c){var o=c.replace("["+r+"]","["+i+"]");p[o]=p[o]?p[o]:[],p[o].push(n.val())}})),n.find("input:checkbox,input:radio").each((function(a,t){var n=e(t),i=n.attr("name");i&&(n.prop("checked",!1),e.inArray(n.val(),p[i])>=0&&n.prop("checked",!0).trigger("change"))})),t.find("input, textarea, select").each((function(a,t){var n=e(t);"checkbox"!=n.attr("type")&&"radio"!=n.attr("type")&&n.val(c[n.attr("name")]).trigger("change")})),t.find("input:checkbox,input:radio").each((function(a,t){var n=e(t),i=n.attr("name");i&&(n.prop("checked",!1),e.inArray(n.val(),c[i])>=0&&n.prop("checked",!0).trigger("change"))}))})).on("change","input, textarea, select",(function(){var a=e(this),t=a.attr("name");if(t){t=t.replace(/\[[^\[\]]\]/,"");var n=a.closest(".wpcom-panel-item,.wpcom-panel-wrapper,.repeat-wrap").find('[filter*="'+t+':"]');if(n&&n.length){n.hide();var i=a.val();"checkbox"!=a.attr("type")&&"radio"!=a.attr("type")||(i=a.closest(".form-input").find("input:checkbox:checked,input:radio:checked").val());var r=n.closest('[filter*="'+t+":"+i+',"],[filter$="'+t+":"+i+'"]');if(r.length&&(r.show(),r.closest(".wpcom-panel-item,.wpcom-panel-wrapper,.repeat-wrap").find("input, textarea, select").not('[name*="'+t+'"]').trigger("change")),i&&""!==i){var c=n.closest('[filter*="'+t+":"+i+'!!!"]');c.show(),c.closest(".wpcom-panel-item,.wpcom-panel-wrapper,.repeat-wrap").find("input, textarea, select").not('[name*="'+t+'"]').trigger("change")}}}})),a.find("input, textarea, select").trigger("change"),e("#j-check-version").on("click",(function(){var a=e(this),t=a.data("action");t&&(a.html("\u68c0\u67e5\u4e2d..."),e.getJSON(ajaxurl,{action:t},(function(e){var t='<span class="check-version">\u6700\u65b0\u7248\u672c\uff1a<span style="color: green;">'+e.version+'</span>\uff0c<a href="https://www.wpcom.cn/help/62.html" target="_blank">\u67e5\u770b\u4e3b\u9898\u5728\u7ebf\u66f4\u65b0\u6559\u7a0b</a></span>';e.version==e.current&&(t='<span class="check-version">\u6700\u65b0\u7248\u672c\uff1a<span style="color: green;">'+e.version+"</span>"),a.parent().append(t),a.hide()})))}));var t=e(".j-cat-sort"),n={};if(t.length)for(var i=function(){var a=e(t[r]).data("name");n[a]={},n[a].y=[],n[a].n=[],e(t[r]).find("label").each((function(t,i){e(i).find("input").is(":checked")?n[a].y.push({id:e(i).find("input").val(),name:e.trim(e(i).text())}):n[a].n.push({id:e(i).find("input").val(),name:e.trim(e(i).text())})}))},r=0;r<t.length;r++)i();function c(a){for(var t in a){for(var n=e('[data-name="'+t+'"]'),i="",r=0;r<a[t].y.length;r++)a[t].y[r]&&a[t].y[r].name&&(i+='<label class="checkbox-inline"><input name="'+t+'[]" checked type="checkbox" value="'+a[t].y[r].id+'"> '+a[t].y[r].name+"</label>");for(var c=0;c<a[t].n.length;c++)a[t].n[c]&&a[t].n[c].name&&(i+='<label class="checkbox-inline"><input name="'+t+'[]" type="checkbox" value="'+a[t].n[c].id+'"> '+a[t].n[c].name+"</label>");n.html(i)}}c(n),t.on("change","input",(function(){for(var a=e(this),t=a.closest(".j-cat-sort").data("name"),i=a.is(":checked"),r=0;r<n[t][i?"n":"y"].length;r++)n[t][i?"n":"y"][r]&&n[t][i?"n":"y"][r].id==a.val()&&delete n[t][i?"n":"y"][r];n[t][i?"y":"n"].push({id:a.val(),name:e.trim(a.parent().text())}),c(n)}))}))}));
